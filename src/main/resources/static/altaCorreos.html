
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Alta de Correos</title>
</head>
<body>
	<a href="correos.html">Volver</a>
	<h2>Alta de Correos</h2>
	<form id="altaCorreosForm" method="get" target="salidaAltaCorreos">
		DNI: <select id="dni" name="dni" required>
        	<option value="" selected disabled hidden>-- Seleccionar DNI --</option>
		</select>
		Correo: <input type="email" id="correo" name="correo" value="usuario@servidor.com"><br> 
		<input type="submit" value="Enviar" name="Enviar">
	</form>

</body>

<script>
	window.addEventListener("DOMContentLoaded", () => {
		const dniSelect = document.getElementById("dni");
		fetch("clientes/listartodos")
		.then(results => results.json())
		.then(results => {
			results.forEach(cliente => {
				const option = new Option(`${cliente.dni} (${cliente.apellido} ${cliente.nombre})`, cliente.dni);
				dniSelect.add(option)
			});
		})
	});

	document.getElementById("altaCorreosForm").onsubmit = function(event) {
		event.preventDefault(); // Evita el envÃ­o predeterminado del formulario
		const dni = document.getElementById("dni").value;
		const correo = document.getElementById("correo").value;

		fetch(`/correos/guardar/${dni}/${correo}`)
		.then(async results => {
			if (!results.ok) {
				const message = await results.text();
				return alert(message)
			}

			const message = await results.text();
			alert(message)
			window.location.replace("correos.html")
			
		})
	};
</script>
</html>